<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href = "C:/Users/orian/preonboarding-projects/tabithasworld/tabitha/src/test/java/com/tabitha/resources/webpages/css/login.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crafty+Girls&family=Jost:wght@300&display=swap');
    </style>
</head>
<body>
    <img src = "../css/images/IMG-7172.PNG" alt = "Tabitha's World Logo" id = "logo">
    <div id = "login-div">
        <h1>Login</h1>
        <label for = "login-username">Username</label>
        <br>
        <input id = "login-username" type = "text">
        <br>
        <label for = "login-password">Password</label>
        <br>
        <input id = "login-password" type = "password">
        <br>
        <button id = "login-button" onclick = "login()">Go!</button>
        <h3>New here? <a id = "registration-link" href = registration.html>Register</a></h3>
    </div>
    <img src = "../css/images/pigflying.gif" alt = "flying pig" id = "flying-pig">
</body>
<script>
    const username = document.getElementById("login-username");
    const password = document.getElementById("login-password");
    const loginButton = document.getElementById("login-button");
    const registrationLink = document.getElementById("registration-link");

    async function changeRegistrationLinkColor(){
        registrationLink.style.color = "#8d6cad";
    }

    async function revertRegistrationLinkColor(){
        registrationLink.style.color = "#c564b1";
    }

    registrationLink.addEventListener("mouseover", changeRegistrationLinkColor);
    registrationLink.addEventListener("mouseleave", revertRegistrationLinkColor);

    async function changeLoginButtonColor(){
        loginButton.style.color = "white"
    }

    async function revertLoginButtonColor(){
        loginButton.style.color = "#8d6cad"
    }

    loginButton.addEventListener("mouseover", changeLoginButtonColor);
    loginButton.addEventListener("mouseleave", revertLoginButtonColor);

    async function login(){
        let loginInfo = {
            username: username.value,
            user_password: password.value
        };
        sessionStorage.setItem("sessionUsername", username.value);
        let loginJSON = JSON.stringify(loginInfo);

        let config = {
            method: "PATCH",
            headers: {'Content-Type': "application/json"},
            body: loginJSON
        };

        console.log(loginJSON);
        let httpResponse = await fetch("http://localhost:8080/tabitha/user/login", config);
        console.log(httpResponse.status);

        if(httpResponse.status === 200){
            let responseBody = await httpResponse.json();
            window.location.href = "checkin.html";
        } else {
            alert("Could not login, your login credentials may be incorrect.");
        }
    }
</script>
</html>